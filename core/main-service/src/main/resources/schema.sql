-- CREATE TABLE IF NOT EXISTS users (
--     id BIGINT GENERATED ALWAYS AS IDENTITY PRIMARY KEY,
--     name VARCHAR(255) NOT NULL,
--     email VARCHAR(255) NOT NULL UNIQUE
-- );

CREATE TABLE IF NOT EXISTS LOCATIONS (
    ID  BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    LAT FLOAT                                   NOT NULL,
    LON FLOAT                                   NOT NULL,
    CONSTRAINT PK_LOCATION
        PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS categories (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(150) NOT NULL,
    CONSTRAINT uq_category_name UNIQUE (name)
);

CREATE TABLE IF NOT EXISTS EVENTS (
    ID                 BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    ANNOTATION         VARCHAR(2000),
    CATEGORY_ID        BIGINT,
    CONFIRMED_REQUESTS BIGINT,
    DESCRIPTION        TEXT,
    EVENT_DATE         TIMESTAMP WITHOUT TIME ZONE,
    CREATED_ON         TIMESTAMP WITHOUT TIME ZONE,
    INITIATOR_ID       BIGINT,
    LOCATION_ID        BIGINT,
    PAID               BOOLEAN,
    PARTICIPANT_LIMIT  INTEGER,
    PUBLISHED_ON       TIMESTAMP WITHOUT TIME ZONE,
    REQUEST_MODERATION BOOLEAN,
    STATE              VARCHAR(120),
    TITLE              VARCHAR(120),
    VIEWS              BIGINT,
    CONSTRAINT PK_EVENT
        PRIMARY KEY (ID),
    CONSTRAINT EVENTS_CATEGORIES_ID_FK
        FOREIGN KEY (CATEGORY_ID)
            REFERENCES CATEGORIES (ID) ON DELETE CASCADE,
    CONSTRAINT EVENTS_LOCATIONS_ID_FK
        FOREIGN KEY (LOCATION_ID)
            REFERENCES LOCATIONS (ID) ON DELETE CASCADE
--     CONSTRAINT EVENTS_USERS_ID_FK
--         FOREIGN KEY (INITIATOR_ID)
--             REFERENCES USERS (ID) ON DELETE CASCADE
);

-- CREATE TABLE IF NOT EXISTS PARTICIPATION_REQUESTS (
--     ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
--     REQUESTER_ID BIGINT NOT NULL,
--     EVENT_ID BIGINT NOT NULL,
--     STATUS VARCHAR(20) NOT NULL,
--     CREATED TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
-- --     CONSTRAINT FK_REQUEST_USER FOREIGN KEY (REQUESTER_ID)
-- --         REFERENCES USERS (ID) ON DELETE CASCADE,
--     CONSTRAINT FK_REQUEST_EVENT FOREIGN KEY (EVENT_ID)
--         REFERENCES EVENTS (ID) ON DELETE CASCADE
-- );

CREATE TABLE IF NOT EXISTS COMPILATIONS (
    ID                  BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
    TITLE               VARCHAR(50) NOT NULL,
    IS_PINNED           BOOLEAN,
    CONSTRAINT PK_COMPILATION
        PRIMARY KEY (ID)
);

CREATE TABLE IF NOT EXISTS COMPILATION_EVENTS (
    COMPILATION_ID      BIGINT NOT NULL,
    EVENT_ID            BIGINT NOT NULL,
    CONSTRAINT PK_COMPILATION_EVENT
        PRIMARY KEY (COMPILATION_ID, EVENT_ID),
    CONSTRAINT FK_COMPILATION
        FOREIGN KEY (COMPILATION_ID)
            REFERENCES COMPILATIONS(ID) ON DELETE CASCADE,
    CONSTRAINT FK_EVENT
        FOREIGN KEY (EVENT_ID)
            REFERENCES EVENTS(ID) ON DELETE CASCADE
);

-- CREATE TABLE IF NOT EXISTS COMMENTS (
--     ID BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
--     TEXT VARCHAR(1000) NOT NULL,
--     EVENT_ID BIGINT REFERENCES EVENTS (ID) ON DELETE CASCADE NOT NULL,
--     OWNER_ID BIGINT NOT NULL,
--     CREATED TIMESTAMP WITHOUT TIME ZONE,
--     CONSTRAINT PK_COMMENTS PRIMARY KEY (ID),
--     FOREIGN KEY (EVENT_ID) REFERENCES EVENTS(ID)
-- );